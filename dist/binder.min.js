/* Binder.js
Version: 0.1
License: MIT */"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var Binder=function(t,i){var d=this;d.opts=Object.assign({prefix:"x",delimiters:["{{","}}"]},i.config),d.$el=t,d.data=function i(t){var e;{if(t instanceof Date)return t;e=new Proxy(t,{set:function(t,e,n){var r=t[e];return"_"==e.substr(0,1)||n===r||(n&&"object"==_typeof(n)&&(n=i(n)),t[e]=n,a(t,e,n,r)),!0},deleteProperty:function(t,e){var n=t[e];return"_"==e.substr(0,1)||void 0===n||(delete t[e],a(t,e,void 0,n)),!0}})}for(var n in t)t.hasOwnProperty(n)&&t[n]&&"object"==_typeof(t[n])&&(t[n]=i(t[n]));return e}(Object.assign({},i.data,{now:function(){return Date.now()}})),d.directives=Object.assign({bind:function(t,e){var n=this;if(null==e||!1===e)return this.removeAttribute(t);if(n.getAttribute(t)!=e){if(e&&"[object Object]"===Object.prototype.toString.call(e)){if("style"==t)return void Object.keys(e).forEach(function(t){n.style[t]=e[t]});e=Object.keys(e).filter(function(t){return e[t]}).join(" ")}this.type&&"checked"==attr&&(e=""),this.setAttribute(t,Array.isArray(e)?e.join(" "):e)}},html:function(t){this.innerHTML=t},if:function(t){t||((t=document.createComment(" tmp "))._bindedEl=this,t._bindedType="if",this.replaceWith(t))},"else-if":function(t){var e=n(this);e&&(8==e.nodeType&&!e._bindedPrev&&t||((t=document.createComment(" tmp "))._bindedEl=this,t._bindedType="elseif",t._bindedPrev=e._bindedPrev||8!=e.nodeType,this.replaceWith(t)))},else:function(){var t=n(this),e=!0;t&&((8!=t.nodeType||t._bindedPrev||t._bindedEl._bindedAttributes.filter(function(t){return t.name==d.opts.prefix+"-else-if"}).length&&(t=n(t))&&8!=t.nodeType)&&(e=!1),e||((e=document.createComment(" tmp "))._bindedEl=this).replaceWith(e))},for:function(o){var u,t=this,a=t,s=(a._bindedEls||[]).concat();8!=t.nodeType?((a=document.createComment(" tmp "))._bindedTarget=t.cloneNode(!0),a._bindedValue=t.getAttribute(d.opts.prefix+"-for"),a._bindedEls=[],t.before(a),t.remove()):a._bindedEls=[],(Array.isArray(o.list)||"object"==_typeof(o.list)&&null!==o.list)&&((u=Array.isArray(o.list))?o.list:Object.keys(o.list)).forEach(function(n,r,t){var e=u?n:o.list[n],i={loop:{index:r,first:0==r,last:r==t.length-1,length:t.length}};if(o.params.forEach(function(t,e){switch(e){case 0:i[t]=u?n:o.list[n];break;case 1:i[t]=u?r:n;break;case 2:i[t]=r}}),s[r]&&s[r]._bindedVal===e)return s[r]._bindedScope=i,void a._bindedEls.push(s[r]);t=a._bindedTarget.cloneNode(!0);t._bindedVal=e,t._bindedScope=i,t.removeAttribute(d.opts.prefix+"-for"),(a._bindedEls.length?a._bindedEls[a._bindedEls.length-1]:a).after(t),a._bindedEls.push(t)}),s.forEach(function(t){-1==a._bindedEls.indexOf(t)&&t.remove()}),c(a._bindedEls)},model:function(t,n){switch(this.nodeName.toLowerCase()){case"input":case"textarea":switch(this.type){case"checkbox":var e;void 0===d.data[n]&&(r=(e=l(n,'input[type="checkbox"]')).filter(function(t){return t.checked})[0],1<e.length?d.data[n]=r?[r.value]:[]:d.data[n]=!!r),this.checked=Array.isArray(d.data[n])?-1<d.data[n].indexOf(this.value):1==d.data[n],this._bindedModel||(this._bindedModel=!0,this.addEventListener("change",function(){var t=l(n,'input[type="checkbox"]');Array.isArray(d.data[n])?d.data[n]=t.filter(function(t){return t.checked}).map(function(t){return t.value}):d.data[n]=1==this.checked}));break;case"radio":var r;void 0===d.data[n]&&(r=l(n,'input[type="radio"]').filter(function(t){return t.checked})[0],d.data[n]=r?r.value:null),this.checked=d.data[n]==this.value,this._bindedModel||(this._bindedModel=!0,this.addEventListener("change",function(){var e=this;l(n,'input[type="radio"]').forEach(function(t){t.checkbox=t==e}),d.data[n]=this.value}));break;default:void 0===d.data[n]&&(d.data[n]=t||this.value),this.value=d.data[n]||"",this._bindedModel||(this._bindedModel=!0,this.addEventListener("input",function(){d.data[n]=this.value}))}break;case"select":var i=this;void 0===d.data[n]&&(d.data[n]=this.multiple?Array.from(this.selectedOptions).map(function(t){return null!=t.getAttribute("value")?t.value:t.text}):this.value),Array.from(this.options).forEach(function(t){i.multiple?t.selected=-1<d.data[n].indexOf(t.value||t.text):t.selected=d.data[n]==(null!=t.getAttribute("value")?t.value:t.text)}),this._bindedModel||(this._bindedModel=!0,this.addEventListener("change",function(){this.multiple?d.data[n]=Array.from(this.selectedOptions).map(function(t){return null!=t.getAttribute("value")?t.value:t.text}):d.data[n]=this.value}))}},on:function(t,e,n,r){this._bindedEvents||(this._bindedEvents={}),this._bindedEvents[t]||(this._bindedEvents[t]=!0,this.addEventListener(t,function(t){this._bindedEvent=!0,function(t,e,n,r){var t=(i=t.match(/(.*?)($|\(.*?\))/))[1].trim(),i=i[2]?i[2].substr(1,i[2].length-2).split(/,(?=(?:(?:[^'"]*(?:'|")){2})*[^'"]*$)/).map(function(t){return h(t.trim(),n)}):[];if(d.methods[t])d.methods[t].apply(e,r.concat(i))}(e,this,r,[t])}))},show:function(t){t?"none"===getComputedStyle(this).display&&(this.style.display="block"):this.style.display="none"},text:function(t){this.innerText=t}},i.directives),d.methods=Object.assign({},i.methods),d.filters=Object.assign({abs:function(){return Math.abs(this)},capitalize:function(){var t=this+"";return t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()},date:function(t){function e(t,e){return u[t]?u[t]():e}function r(t,e){for(t=String(t);t.length<e;)t="0"+t;return t}var n=Math.floor(this/1e3),i=["Sun","Mon","Tues","Wednes","Thurs","Fri","Satur","January","February","March","April","May","June","July","August","September","October","November","December"],o=/\\?(.?)/gi,u={d:function(){return r(u.j(),2)},D:function(){return u.l().slice(0,3)},j:function(){return a.getDate()},l:function(){return i[u.w()]+"day"},N:function(){return u.w()||7},S:function(){var t=u.j(),e=t%10;return e<=3&&1===parseInt(t%100/10,10)&&(e=0),["st","nd","rd"][e-1]||"th"},w:function(){return a.getDay()},z:function(){var t=new Date(u.Y(),u.n()-1,u.j()),e=new Date(u.Y(),0,1);return Math.round((t-e)/864e5)},W:function(){var t=new Date(u.Y(),u.n()-1,u.j()-u.N()+3),e=new Date(t.getFullYear(),0,4);return r(1+Math.round((t-e)/864e5/7),2)},F:function(){return i[6+u.n()]},m:function(){return r(u.n(),2)},M:function(){return u.F().slice(0,3)},n:function(){return a.getMonth()+1},t:function(){return new Date(u.Y(),u.n(),0).getDate()},L:function(){var t=u.Y();return t%4==0&t%100!=0|t%400==0},o:function(){var t=u.n(),e=u.W();return u.Y()+(12===t&&e<9?1:1===t&&9<e?-1:0)},Y:function(){return a.getFullYear()},y:function(){return u.Y().toString().slice(-2)},a:function(){return 11<a.getHours()?"pm":"am"},A:function(){return u.a().toUpperCase()},B:function(){var t=3600*a.getUTCHours(),e=60*a.getUTCMinutes(),n=a.getUTCSeconds();return r(Math.floor((t+e+n+3600)/86.4)%1e3,3)},g:function(){return u.G()%12||12},G:function(){return a.getHours()},h:function(){return r(u.g(),2)},H:function(){return r(u.G(),2)},i:function(){return r(a.getMinutes(),2)},s:function(){return r(a.getSeconds(),2)},u:function(){return r(1e3*a.getMilliseconds(),6)},e:function(){throw new Error("Not supported (see source code of date() for timezone on how to add support)")},I:function(){return new Date(u.Y(),0)-Date.UTC(u.Y(),0)!=new Date(u.Y(),6)-Date.UTC(u.Y(),6)?1:0},O:function(){var t=a.getTimezoneOffset(),e=Math.abs(t);return(0<t?"-":"+")+r(100*Math.floor(e/60)+e%60,4)},P:function(){var t=u.O();return t.substr(0,3)+":"+t.substr(3,2)},T:function(){return"UTC"},Z:function(){return 60*-a.getTimezoneOffset()},c:function(){return"Y-m-d\\TH:i:sP".replace(o,e)},r:function(){return"D, d M Y H:i:s O".replace(o,e)},U:function(){return a/1e3|0}},t=t=t||"r",a=void 0===(n=n)?new Date:n instanceof Date?new Date(n):new Date(1e3*n);return t.replace(o,e)},first:function(){return this[0]},floor:function(){return Math.floor(this)},join:function(t){return Array.isArray(this)?this.join(void 0===t?", ":t):""},json_encode:function(){return JSON.stringify(this)},last:function(){return this[this.length-1]},length:function(){return this.length||(this&&"object"==_typeof(this)?Object.keys(this).length:0)},lower:function(){return(this+"").toLowerCase()},number_format:function(t,e,n){var r=(this+"").replace(/[^0-9+\-Ee.]/g,""),r=isFinite(+r)?+r:0;n=void 0===n?",":n,e=void 0===e?".":e;var i="";return 3<(i=((t=isFinite(+t)?Math.abs(t):0)?function(t,e){if(-1===(""+t).indexOf("e"))return+(Math.round(t+"e+"+e)+"e-"+e);var n="";return 0<+(t=(""+t).split("e"))[1]+e&&(n="+"),(+(Math.round(+t[0]+"e"+n+(+t[1]+e))+"e-"+e)).toFixed(e)}(r,t).toString():""+Math.round(r)).split("."))[0].length&&(i[0]=i[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,n)),(i[1]||"").length<t&&(i[1]=i[1]||"",i[1]+=new Array(t-i[1].length+1).join("0")),i.join(e)},replace:function(t,e){return(this+"").replaceAll(t,e)},reverse:function(){return this.reverse()},round:function(){return Math.round(this)},slice:function(t,e){return this.slice(t,e)},split:function(t){return(this+"").split(t||"")},sort:function(){return this.sort()},title:function(){return this.split(" ").map(function(t){return t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()}).join(" ")},trim:function(){return(this+"").trim()},upper:function(){return(this+"").toUpperCase()},url_encode:function(){return encodeURIComponent(this)}},i.filters),d.update=function(t){u(t)};var r=["var","const","let","eval","=","+=","-=","++","--"],o=["pop","push","reduce","reverse","shift","slice","sort","unshift","freeze","seal","setPrototypeOf"];function u(t){c(t||d.$el),i.onRender&&i.onRender(t||d.$el)}function a(t,e,n,r){u(),i.onChange&&i.onChange(d.$el,t,e,n,r)}function c(t){if("SCRIPT"!==t.nodeName&&"STYLE"!==t.nodeName)for(var e=Array.isArray(t)?t.concat():Array.from(t.childNodes);e.length;){var n,r=e[0];if(1==r.nodeType){for(var i=r._bindedAttributes||Array.from(r.attributes),o=0;o<i.length;o++){var u=i[o],a=u.name;0==a.indexOf(":")&&(a=d.opts.prefix+"-bind"+a),0==a.indexOf("@")&&(a=d.opts.prefix+"-on:"+a.substr(1)),0==a.indexOf(d.opts.prefix+"-")&&(-1<a.indexOf("cloak")||(r._bindedAttributes||(r._bindedAttributes=[]),-1==r._bindedAttributes.indexOf(u)&&r._bindedAttributes.push(u),s(r,a.substr(2),u.value,b(r)),r.removeAttribute(u.name)))}c(r),r.removeAttribute(d.opts.prefix+"-cloak")}else 3==r.nodeType?(r._bindedValue||r.nodeValue.match(new RegExp("\\"+d.opts.delimiters[0]+".*?\\"+d.opts.delimiters[1])))&&(n=function(t,e){for(var n=t.match(new RegExp("\\"+d.opts.delimiters[0]+".*?\\"+d.opts.delimiters[1],"g")),r=0;r<n.length;r++){var i,o=new RegExp("\\"+d.opts.delimiters[0]+"(.*?)\\"+d.opts.delimiters[1],"g").exec(t);o&&(i=f(o[1].trim(),e),t=t.replace(o[0],null!=i?i.toString?i.toString():i:""))}return t}(r._bindedValue||r.nodeValue,b(r)),r._bindedValue||(r._bindedValue=r.nodeValue),r.nodeValue=n):8==r.nodeType&&(r._bindedEl?(r.replaceWith(r._bindedEl),e.splice(1,0,r._bindedEl)):r._bindedTarget&&s(r,"for",r._bindedValue,b(r)));e.splice(0,1)}}function s(t,e,n,r){var i,o=n;-1<e.indexOf(":")?(i=e.split(":"),d.directives[i[0]]&&("on"!=i[0]&&(o=f(n,r)),d.directives[i[0]].call(t,i[1],o,n,r))):d.directives[e]&&(o=("for"==e?function(t,e){t=t.match(/^(.*?)(?:$| in (.*?))$/),e=h(t[2]||t[1],e);isNaN(parseFloat(e))||(e=Array.from(Array(e+1).keys()).filter(function(t){return 0<t}));t=t[2]?t[1].includes(",")?t[1].substr(1,t[1].length-2).split(",").map(function(t){return t.trim()}):[t[1].trim()]:[];return{list:e,params:t}}:f)(n,r),d.directives[e].call(t,o,n,r))}function l(e,t){t=1<arguments.length&&void 0!==t?t:"*";return Array.from(d.$el.querySelectorAll(t)).filter(function(t){return t._bindedAttributes?t._bindedAttributes.filter(function(t){return t.name==d.opts.prefix+"-model"&&t.value==e}).length:t.getAttribute(d.opts.prefix+"-model")==e})}function f(t,e){return function o(t,u){var a=[],e=t.split(/(\+|-|\*|\*\*|\/|%|==|===|\!=|\!==|>|<|>=|<=|\?|:|&&|\|\||\{|\})/).map(function(t,e,n){if((-1<t.indexOf('"')&&2==t.split('"').length||-1<t.indexOf("'")&&2==t.split("'").length)&&n.length>=e+2)return n[e+1]=t+n[e+1],"";if(e%2)return t;if(t.split("(").length!=t.split(")").length&&n.length>=e+3)return n[e+2]=t.replace(t.replace("(",""),"__$arr["+e+"]")+n[e+1]+n[e+2],a.push(e,e+1),n[e]=h(t.replace("(",""),u);var r=t.match(/\((.*[^\(])\)/),i=!1;if(!r||(t.split("|").forEach(function(t,e){-1<t.indexOf(r[0])&&e&&(i=!0)}),i))return h(t.trim(),u,!0);var n=o(r[1],Object.assign(u||{},{__$arr:n}));return 0<(n+"").length?h(t.replace(r[1],p(n,!0)),u,!0):n});var n="";try{n=new Function("return "+e.filter(function(t,e){return void 0!==t&&-1===a.indexOf(e)}).join(""))()}catch(t){}return void 0===n||n.toString&&"NaN"==n.toString()?"":n}(t,e)}function h(t,n,e){var r=t.match(/^(.*?)(?:|\|(.*?))$/),t=r[1].trim(),r=r[2]?r[2].trim():null,i=function(e,t){try{var n;try{n=new Function("_scope","return _scope."+e)(t)}catch(t){}if(null==n)try{var r=e.split("(").shift();n=new Function("_","return _.data."+r+'.toString().indexOf("[native code]") > -1 && '+(-1<o.indexOf(r.split(".").pop()))+" ? undefined : _.data."+e)(d)}catch(t){}if(null==n)throw"";return p(n)}catch(t){try{return!e.match(/^(?:['"]).*?(?:['"])$/)&&e.match(/=|\+=|-=|\+\+|--|\w+\(/)?void 0:new Function("return "+e)()}catch(t){return}}}(t,n);return void 0!==i&&(r&&r.split("|").map(function(t){var e=t.match(/(.*?)($|\(.*?\))/),t=e[1].trim(),e=e[2]?e[2].substr(1,e[2].length-2).split(/,(?=(?:(?:[^'"]*(?:'|")){2})*[^'"]*$)/).map(function(t){return h(t.trim(),n)}):[];d.filters[t]?i=d.filters[t].apply(i,e):"string"==typeof val&&String.prototype[t]&&(i=String.prototype[t].apply(i,e))}),e&&(i=p(i,!0))),i}function p(e,t){var n=['"',"'"];return"null"==e?null:"undefined"!=e?isNaN(parseFloat(e))?"string"==typeof e?e.length?'""'==e||"''"==e?"''":0===e.indexOf("__$arr")||-1<n.indexOf(e[0])&&-1<n.indexOf(e[e.length-1])?e:!t&&r.filter(function(t){return-1<e.indexOf(t)}).length?" %i%n ":t?"'"+e.replace(/'/g,"\\'")+"'":e:e:e.concat?e.concat():e.defineProperty?Object.assign({},e):e:parseFloat(e):void 0}function b(t){if(t&&t!=d.$el)return t._bindedScope||(t.parentNode?b(t.parentNode):void 0)}function n(t){for(var e;!e;){if(!(t=t.previousSibling)||t==d.$el)return null;(1==t.nodeType||8==t.nodeType&&t._bindedEl)&&(e=t)}return e}u(),d.$el.removeAttribute(d.opts.prefix+"-cloak"),i.onReady&&i.onReady(d.$el)};