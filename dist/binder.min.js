/* Binder.js
Version: 0.1
License: MIT */"use strict";const Binder=function(e,r){const d=this;d.opts=Object.assign({prefix:"x",delimiters:["{{","}}"]},r.config),d.$el=e,d.data=function r(e){let t;{if(e instanceof Date)return e;t=new Proxy(e,{set:function(e,t,n){var i=e[t];return"_"==t.substr(0,1)||n===i||(n&&"object"==typeof n&&(n=r(n)),e[t]=n,s(e,t,n,i)),!0},deleteProperty:function(e,t){var n=e[t];return"_"==t.substr(0,1)||void 0===n||(delete e[t],s(e,t,void 0,n)),!0}})}for(var n in e)e.hasOwnProperty(n)&&e[n]&&"object"==typeof e[n]&&(e[n]=r(e[n]));return t}(Object.assign({},r.data,{now:function(){return Date.now()}})),d.directives=Object.assign({bind:function(e,t){var n=this;if(null==t||!1===t)return this.removeAttribute(e);if(n.getAttribute(e)!=t){if(t&&"[object Object]"===Object.prototype.toString.call(t)){if("style"==e)return void Object.keys(t).forEach(function(e){n.style[e]=t[e]});t=Object.keys(t).filter(e=>t[e]).join(" ")}this.type&&"checked"==attr&&(t=""),this.setAttribute(e,Array.isArray(t)?t.join(" "):t)}},html:function(e){this.innerHTML=e},if:function(e){if(!e){let e=document.createComment(" tmp ");e._bindedEl=this,e._bindedType="if",this.replaceWith(e)}},"else-if":function(e){var t=n(this);if(t&&(8!=t.nodeType||t._bindedPrev||!e)){let e=document.createComment(" tmp ");e._bindedEl=this,e._bindedType="elseif",e._bindedPrev=t._bindedPrev||8!=t.nodeType,this.replaceWith(e)}},else:function(){let e=n(this),t=!0;if(e&&(8!=e.nodeType||e._bindedPrev?t=!1:e._bindedEl._bindedAttributes.filter(e=>e.name==d.opts.prefix+"-else-if").length&&(e=n(e),e&&8!=e.nodeType&&(t=!1)),!t)){let e=document.createComment(" tmp ");(e._bindedEl=this).replaceWith(e)}},for:function(s){let e=this,a=e,u=(a._bindedEls||[]).concat();var l;8!=e.nodeType?(a=document.createComment(" tmp "),a._bindedTarget=e.cloneNode(!0),a._bindedValue=e.getAttribute(d.opts.prefix+"-for"),a._bindedEls=[],e.before(a),e.remove()):a._bindedEls=[],(Array.isArray(s.list)||"object"==typeof s.list&&null!==s.list)&&((l=Array.isArray(s.list))?s.list:Object.keys(s.list)).forEach(function(n,i,e){let t=l?n:s.list[n],r={loop:{index:i,first:0==i,last:i==e.length-1,length:e.length}};if(s.params.forEach((e,t)=>{switch(t){case 0:r[e]=l?n:s.list[n];break;case 1:r[e]=l?i:n;break;case 2:r[e]=i}}),u[i]&&u[i]._bindedVal===t)return u[i]._bindedScope=r,void a._bindedEls.push(u[i]);let o=a._bindedTarget.cloneNode(!0);o._bindedVal=t,o._bindedScope=r,o.removeAttribute(d.opts.prefix+"-for"),(a._bindedEls.length?a._bindedEls[a._bindedEls.length-1]:a).after(o),a._bindedEls.push(o)}),u.forEach(e=>{-1==a._bindedEls.indexOf(e)&&e.remove()}),c(a._bindedEls)},model:function(e,n){switch(this.nodeName.toLowerCase()){case"input":case"textarea":switch(this.type){case"checkbox":if(void 0===d.data[n]){let e=l(n,'input[type="checkbox"]'),t=e.filter(e=>e.checked)[0];1<e.length?d.data[n]=t?[t.value]:[]:d.data[n]=!!t}this.checked=Array.isArray(d.data[n])?-1<d.data[n].indexOf(this.value):1==d.data[n],this._bindedModel||(this._bindedModel=!0,this.addEventListener("change",function(){let e=l(n,'input[type="checkbox"]');Array.isArray(d.data[n])?d.data[n]=e.filter(e=>e.checked).map(e=>e.value):d.data[n]=1==this.checked}));break;case"radio":var t;void 0===d.data[n]&&(t=l(n,'input[type="radio"]').filter(e=>e.checked)[0],d.data[n]=t?t.value:null),this.checked=d.data[n]==this.value,this._bindedModel||(this._bindedModel=!0,this.addEventListener("change",function(){var t=this;l(n,'input[type="radio"]').forEach(function(e){e.checkbox=e==t}),d.data[n]=this.value}));break;default:void 0===d.data[n]&&(d.data[n]=e||this.value),this.value=d.data[n]||"",this._bindedModel||(this._bindedModel=!0,this.addEventListener("input",function(){d.data[n]=this.value}))}break;case"select":var i=this;void 0===d.data[n]&&(d.data[n]=this.multiple?Array.from(this.selectedOptions).map(e=>null!=e.getAttribute("value")?e.value:e.text):this.value),Array.from(this.options).forEach(function(e){i.multiple?e.selected=-1<d.data[n].indexOf(e.value||e.text):e.selected=d.data[n]==(null!=e.getAttribute("value")?e.value:e.text)}),this._bindedModel||(this._bindedModel=!0,this.addEventListener("change",function(){this.multiple?d.data[n]=Array.from(this.selectedOptions).map(e=>null!=e.getAttribute("value")?e.value:e.text):d.data[n]=this.value}))}},on:function(e,s,t,n){this._bindedEvents||(this._bindedEvents={}),this._bindedEvents[e]||(this._bindedEvents[e]=!0,this.addEventListener(e,function(e){this._bindedEvent=!0,function(e,t,n){let i=s.match(/(.*?)($|\(.*?\))/),r=i[1].trim(),o=i[2]?i[2].substr(1,i[2].length-2).split(/,(?=(?:(?:[^'"]*(?:'|")){2})*[^'"]*$)/).map(e=>h(e.trim(),t)):[];if(d.methods[r])d.methods[r].apply(e,n.concat(o))}(this,n,[e])}))},show:function(e){e?"none"===getComputedStyle(this).display&&(this.style.display="block"):this.style.display="none"},text:function(e){this.innerText=e}},r.directives),d.methods=Object.assign({},r.methods),d.filters=Object.assign({abs:function(){return Math.abs(this)},capitalize:function(){let e=this+"";return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()},date:function(e){function t(e,t){return s[e]?s[e]():t}function i(e,t){for(e=String(e);e.length<t;)e="0"+e;return e}var n=Math.floor(this/1e3),r=["Sun","Mon","Tues","Wednes","Thurs","Fri","Satur","January","February","March","April","May","June","July","August","September","October","November","December"],o=/\\?(.?)/gi,s={d:function(){return i(s.j(),2)},D:function(){return s.l().slice(0,3)},j:function(){return a.getDate()},l:function(){return r[s.w()]+"day"},N:function(){return s.w()||7},S:function(){var e=s.j(),t=e%10;return t<=3&&1===parseInt(e%100/10,10)&&(t=0),["st","nd","rd"][t-1]||"th"},w:function(){return a.getDay()},z:function(){var e=new Date(s.Y(),s.n()-1,s.j()),t=new Date(s.Y(),0,1);return Math.round((e-t)/864e5)},W:function(){var e=new Date(s.Y(),s.n()-1,s.j()-s.N()+3),t=new Date(e.getFullYear(),0,4);return i(1+Math.round((e-t)/864e5/7),2)},F:function(){return r[6+s.n()]},m:function(){return i(s.n(),2)},M:function(){return s.F().slice(0,3)},n:function(){return a.getMonth()+1},t:function(){return new Date(s.Y(),s.n(),0).getDate()},L:function(){var e=s.Y();return e%4==0&e%100!=0|e%400==0},o:function(){var e=s.n(),t=s.W();return s.Y()+(12===e&&t<9?1:1===e&&9<t?-1:0)},Y:function(){return a.getFullYear()},y:function(){return s.Y().toString().slice(-2)},a:function(){return 11<a.getHours()?"pm":"am"},A:function(){return s.a().toUpperCase()},B:function(){var e=3600*a.getUTCHours(),t=60*a.getUTCMinutes(),n=a.getUTCSeconds();return i(Math.floor((e+t+n+3600)/86.4)%1e3,3)},g:function(){return s.G()%12||12},G:function(){return a.getHours()},h:function(){return i(s.g(),2)},H:function(){return i(s.G(),2)},i:function(){return i(a.getMinutes(),2)},s:function(){return i(a.getSeconds(),2)},u:function(){return i(1e3*a.getMilliseconds(),6)},e:function(){throw new Error("Not supported (see source code of date() for timezone on how to add support)")},I:function(){return new Date(s.Y(),0)-Date.UTC(s.Y(),0)!=new Date(s.Y(),6)-Date.UTC(s.Y(),6)?1:0},O:function(){var e=a.getTimezoneOffset(),t=Math.abs(e);return(0<e?"-":"+")+i(100*Math.floor(t/60)+t%60,4)},P:function(){var e=s.O();return e.substr(0,3)+":"+e.substr(3,2)},T:function(){return"UTC"},Z:function(){return 60*-a.getTimezoneOffset()},c:function(){return"Y-m-d\\TH:i:sP".replace(o,t)},r:function(){return"D, d M Y H:i:s O".replace(o,t)},U:function(){return a/1e3|0}},e=e=e||"r",a=void 0===(n=n)?new Date:n instanceof Date?new Date(n):new Date(1e3*n);return e.replace(o,t)},first:function(){return this[0]},floor:function(){return Math.floor(this)},join:function(e){return Array.isArray(this)?this.join(void 0===e?", ":e):""},json_encode:function(){return JSON.stringify(this)},last:function(){return this[this.length-1]},length:function(){return this.length||(this&&"object"==typeof this?Object.keys(this).length:0)},lower:function(){return(this+"").toLowerCase()},number_format:function(e,t,n){let i=(this+"").replace(/[^0-9+\-Ee.]/g,"");i=isFinite(+i)?+i:0,e=isFinite(+e)?Math.abs(e):0,n=void 0===n?",":n,t=void 0===t?".":t;let r="";return r=(e?function(t,n){if(-1===(""+t).indexOf("e"))return+(Math.round(t+"e+"+n)+"e-"+n);{t=(""+t).split("e");let e="";return 0<+t[1]+n&&(e="+"),(+(Math.round(+t[0]+"e"+e+(+t[1]+n))+"e-"+n)).toFixed(n)}}(i,e).toString():""+Math.round(i)).split("."),3<r[0].length&&(r[0]=r[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,n)),(r[1]||"").length<e&&(r[1]=r[1]||"",r[1]+=new Array(e-r[1].length+1).join("0")),r.join(t)},replace:function(e,t){return(this+"").replaceAll(e,t)},reverse:function(){return this.reverse()},round:function(){return Math.round(this)},slice:function(e,t){return this.slice(e,t)},split:function(e){return(this+"").split(e||"")},sort:function(){return this.sort()},title:function(){return this.split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" ")},trim:function(){return(this+"").trim()},upper:function(){return(this+"").toUpperCase()},url_encode:function(){return encodeURIComponent(this)}},r.filters),d.update=function(e){o(e)};const i=["var","const","let","eval","=","+=","-=","++","--"],a=["pop","push","reduce","reverse","shift","slice","sort","unshift","freeze","seal","setPrototypeOf"];function o(e){c(e||d.$el),r.onRender&&r.onRender(e||d.$el)}function s(e,t,n,i){o(),r.onChange&&r.onChange(d.$el,e,t,n,i)}function c(t){if("SCRIPT"!==t.nodeName&&"STYLE"!==t.nodeName){let e=Array.isArray(t)?t.concat():Array.from(t.childNodes);for(;e.length;){let o=e[0];if(1==o.nodeType){let i=o._bindedAttributes||Array.from(o.attributes),r=o.childNodes.length;for(let n=0;n<i.length;n++){let e=i[n],t=e.name;0==t.indexOf(":")&&(t=d.opts.prefix+"-bind"+t),0==t.indexOf("@")&&(t=d.opts.prefix+"-on:"+t.substr(1)),0==t.indexOf(d.opts.prefix+"-")&&(t!=d.opts.prefix+"-cloak"?(o._bindedAttributes||(o._bindedAttributes=[]),-1==o._bindedAttributes.indexOf(e)&&o._bindedAttributes.push(e),t!=d.opts.prefix+"-ignore"?(u(o,t.substr(2),e.value,b(o)),o.removeAttribute(e.name)):(r=0,o.removeAttribute(t))):o.removeAttribute(t))}r&&c(o)}else{var n;3==o.nodeType?(o._bindedValue||o.nodeValue.match(new RegExp("\\"+d.opts.delimiters[0]+".*?\\"+d.opts.delimiters[1])))&&(n=function(t,n){var i=t.match(new RegExp("\\"+d.opts.delimiters[0]+".*?\\"+d.opts.delimiters[1],"g"));for(let e=0;e<i.length;e++){var r=new RegExp("\\"+d.opts.delimiters[0]+"(.*?)\\"+d.opts.delimiters[1],"g").exec(t);if(r){let e=f(r[1].trim(),n);t=t.replace(r[0],null!=e?e.toString?e.toString():e:"")}}return t}(o._bindedValue||o.nodeValue,b(o)),o._bindedValue||(o._bindedValue=o.nodeValue),o.nodeValue=n):8==o.nodeType&&(o._bindedEl?(o.replaceWith(o._bindedEl),e.splice(1,0,o._bindedEl)):o._bindedTarget&&u(o,"for",o._bindedValue,b(o)))}e.splice(0,1)}}}function u(e,t,n,i){let r=n;var o;-1<t.indexOf(":")?(o=t.split(":"),d.directives[o[0]]&&("on"!=o[0]&&(r=f(n,i)),d.directives[o[0]].call(e,o[1],r,n,i))):d.directives[t]&&(r=("for"==t?function(e,t){let n=e.match(/^(.*?)(?:$| in (.*?))$/),i=h(n[2]||n[1],t),r;isNaN(parseFloat(i))||(i=Array.from(Array(i+1).keys()).filter(e=>0<e));r=n[2]?n[1].includes(",")?n[1].substr(1,n[1].length-2).split(",").map(e=>e.trim()):[n[1].trim()]:[];return{list:i,params:r}}:f)(n,i),d.directives[t].call(e,r,n,i))}function l(t,e){return Array.from(d.$el.querySelectorAll(e)).filter(e=>e._bindedAttributes?e._bindedAttributes.filter(e=>e.name==d.opts.prefix+"-model"&&e.value==t).length:e.getAttribute(d.opts.prefix+"-model")==t)}function f(e,t){return function s(e,a){let u=[],t=e.split(/(\+|-|\*|\*\*|\/|%|==|===|\!=|\!==|>|<|>=|<=|\?|:|&&|\|\||\{|\})/).map(function(e,t,n){if((-1<e.indexOf('"')&&2==e.split('"').length||-1<e.indexOf("'")&&2==e.split("'").length)&&n.length>=t+2)return n[t+1]=e+n[t+1],"";if(t%2)return e;if(e.split("(").length!=e.split(")").length&&n.length>=t+3)return n[t+2]=e.replace(e.replace("(",""),"__$arr["+t+"]")+n[t+1]+n[t+2],u.push(t,t+1),n[t]=h(e.replace("(",""),a);let i=e.match(/\((.*[^\(])\)/),r=!1;if(!i||(e.split("|").forEach((e,t)=>{-1<e.indexOf(i[0])&&t&&(r=!0)}),r))return h(e.trim(),a,!0);var o=s(i[1],Object.assign(a||{},{__$arr:n}));return 0<(o+"").length?h(e.replace(i[1],p(o,!0)),a,!0):o});let n="";try{n=new Function("return "+t.filter((e,t)=>void 0!==e&&-1===u.indexOf(t)).join(""))()}catch(e){}return void 0===n||n.toString&&"NaN"==n.toString()?"":n}(e,t)}function h(e,r,t){let n=e.match(/^(.*?)(?:|\|(.*?))$/),i=n[1].trim(),o=n[2]?n[2].trim():null,s=function(n,e){try{let t;try{t=new Function("_scope","return _scope."+n)(e)}catch(e){}if(null==t)try{let e=n.split("(").shift();t=new Function("_","return _.data."+e+'.toString().indexOf("[native code]") > -1 && '+(-1<a.indexOf(e.split(".").pop()))+" ? undefined : _.data."+n)(d)}catch(e){}if(null==t)throw"";return p(t)}catch(e){try{return!n.match(/^(?:['"]).*?(?:['"])$/)&&n.match(/=|\+=|-=|\+\+|--|\w+\(/)?void 0:new Function("return "+n)()}catch(e){return}}}(i,r);return void 0!==s&&(o&&o.split("|").map(function(e){let t=e.match(/(.*?)($|\(.*?\))/),n=t[1].trim(),i=t[2]?t[2].substr(1,t[2].length-2).split(/,(?=(?:(?:[^'"]*(?:'|")){2})*[^'"]*$)/).map(e=>h(e.trim(),r)):[];d.filters[n]?s=d.filters[n].apply(s,i):"string"==typeof val&&String.prototype[n]&&(s=String.prototype[n].apply(s,i))}),t&&(s=p(s,!0))),s}function p(t,e){let n=['"',"'"];return"null"==t?null:"undefined"!=t?isNaN(parseFloat(t))?"string"==typeof t?t.length?'""'==t||"''"==t?"''":0===t.indexOf("__$arr")||-1<n.indexOf(t[0])&&-1<n.indexOf(t[t.length-1])?t:!e&&i.filter(e=>-1<t.indexOf(e)).length?" %i%n ":e?"'"+t.replace(/'/g,"\\'")+"'":t:t:t.concat?t.concat():t.defineProperty?Object.assign({},t):t:parseFloat(t):void 0}function b(e){if(e&&e!=d.$el)return e._bindedScope||(e.parentNode?b(e.parentNode):void 0)}function n(e){let t;for(;!t;){if(!(e=e.previousSibling)||e==d.$el)return null;(1==e.nodeType||8==e.nodeType&&e._bindedEl)&&(t=e)}return t}o(),d.$el.removeAttribute(d.opts.prefix+"-cloak"),r.onReady&&r.onReady(d.$el)};
